---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
    const products = await getCollection('products');
    return products.map((product) => ({
        params: { slug: product.data.slug },
        props: { product },
    }));
}

const { product } = Astro.props;
const base = import.meta.env.BASE_URL;

// Get recipes that might feature this product
const recipes = await getCollection('recipes');
const productRecipes = recipes
    .filter(r => {
        const titleLower = r.data.title.toLowerCase();
        const categoryLower = product.data.category.toLowerCase();
        return titleLower.includes(categoryLower) ||
               titleLower.includes(product.data.name.toLowerCase().replace('planted.', ''));
    })
    .slice(0, 4);

// Fallback to featured recipes if no product-specific ones
const featuredRecipes = productRecipes.length > 0 ? productRecipes : recipes.slice(0, 4);

// Parse ingredients from string to array
const ingredientsList = product.data.ingredients
    ? product.data.ingredients.split(',').map(i => i.trim())
    : ['Pea Protein', 'Water', 'Rapeseed Oil', 'Pea Fiber', 'Salt', 'Vitamin B12'];

// Color mappings for gradients
const colorGradients: Record<string, { main: string; light: string; dark: string }> = {
    yellow: { main: '#E8D494', light: '#F5E6B8', dark: '#D4C074' },
    terracotta: { main: '#D4A894', light: '#E8C4B8', dark: '#C08870' },
    purple: { main: '#61269E', light: '#9B6BC7', dark: '#4A1D7A' },
    olive: { main: '#B4C494', light: '#C8D4B8', dark: '#94A870' },
    burgundy: { main: '#C494A8', light: '#D4B8C4', dark: '#A87088' },
    teal: { main: '#94C4C4', light: '#B8D4D4', dark: '#70A8A8' },
    coral: { main: '#E8B8A4', light: '#F5D4C8', dark: '#D49880' },
    navy: { main: '#94A8C4', light: '#B8C4D4', dark: '#7088A8' },
    green: { main: '#6BBF59', light: '#94D494', dark: '#4A9F40' },
    orange: { main: '#E8B894', light: '#F5D4B8', dark: '#D49870' },
    red: { main: '#E8A4A4', light: '#F5C4C4', dark: '#D48080' },
};

const colors = colorGradients[product.data.color] || colorGradients.purple;
---

<Layout title={`${product.data.name} ${product.data.variant} – Planted`} currentPage="products">
    <!-- Hero Section -->
    <section class="hero" id="hero">
        <div class="hero-sticky">
            <!-- Animated gradient background -->
            <div class="hero-bg"></div>

            <!-- Dish photo (hidden initially, fades in on scroll) -->
            {product.data.images.dish && (
                <div class="hero-dish" id="heroDish">
                    <img src={product.data.images.dish} alt={`Delicious ${product.data.name} dish`} loading="eager">
                </div>
            )}

            <!-- Pack shot (visible initially, animates out on scroll) -->
            <div class="hero-pack" id="heroPack">
                {product.data.isNew && <span class="product-badge-new">New</span>}
                <img src={product.data.images.main} alt={`${product.data.name} ${product.data.variant} packaging`} loading="eager">
            </div>

            <!-- Product info (hidden initially, slides up on scroll) -->
            <div class="hero-info" id="heroInfo">
                <div class="hero-text">
                    <h1>{product.data.name}</h1>
                    <p class="variant">{product.data.variant} — {product.data.description}</p>
                </div>
                <div class="hero-protein">
                    <div class="protein-number">
                        <span class="value">17</span><span class="unit">g</span>
                    </div>
                    <div class="protein-label">Protein per 100g</div>
                </div>
            </div>

            <!-- Scroll indicator -->
            <div class="scroll-hint" id="scrollHint">
                <span>Scroll</span>
                <div class="arrow"></div>
            </div>
        </div>
    </section>

    <!-- Stats Bar - Fiber, B12, Iron, Animals ONLY -->
    <section class="stats">
        <div class="stats-grid">
            <div class="stat">
                <div class="stat-value">5.7g</div>
                <div class="stat-label">Fiber</div>
            </div>
            <div class="stat">
                <div class="stat-value">72%</div>
                <div class="stat-label">Vitamin B12</div>
            </div>
            <div class="stat">
                <div class="stat-value">27%</div>
                <div class="stat-label">Iron</div>
            </div>
            <div class="stat highlight">
                <div class="stat-value">0</div>
                <div class="stat-label">Animals</div>
            </div>
        </div>
    </section>

    <!-- Trust Badges -->
    <section class="trust">
        <div class="trust-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                <path d="M9 12l2 2 4-4"/>
            </svg>
            B Corp Certified
        </div>
        <div class="trust-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
            </svg>
            Made in Switzerland
        </div>
        <div class="trust-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5"/>
                <path d="M2 12l10 5 10-5"/>
            </svg>
            100% Plant-Based
        </div>
    </section>

    <!-- Ingredients -->
    <section class="ingredients reveal">
        <h2>What's inside</h2>
        <div class="pills">
            {ingredientsList.map((ingredient, i) => (
                <div class="pill" style={`--delay: ${i * 0.05}s`}>{ingredient}</div>
            ))}
        </div>
        <div class="ingredient-note">That's it. {ingredientsList.length} ingredients.</div>
    </section>

    <!-- Nutrition -->
    <section class="nutrition">
        <div class="nutrition-layout">
            <div class="nutrition-image">
                <img src={product.data.images.dish || product.data.images.main} alt={`${product.data.name} close-up`} loading="lazy">
            </div>
            <div class="nutrition-content">
                <div class="nutrition-header">
                    <h2>Nutritional values</h2>
                    <button class="nutrition-toggle" id="nutritionToggle" aria-label="Toggle nutrition table">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                </div>

                <div class="nutrition-table" id="nutritionTable">
                    <div class="nutrition-table-inner">
                        <table>
                            <thead>
                                <tr>
                                    <th>Per 100g</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Energy</td><td>718 kJ / 172 kcal</td></tr>
                                <tr><td>Fat</td><td>8.1 g</td></tr>
                                <tr class="sub"><td>of which saturates</td><td>0.7 g</td></tr>
                                <tr><td>Carbohydrates</td><td>4.9 g</td></tr>
                                <tr class="sub"><td>of which sugars</td><td>2.1 g</td></tr>
                                <tr><td>Fiber</td><td>5.7 g</td></tr>
                                <tr class="protein-row"><td>Protein</td><td>17 g</td></tr>
                                <tr><td>Salt</td><td>0.8 g</td></tr>
                                <tr><td>Vitamin B12</td><td>1.8 µg (72%*)</td></tr>
                                <tr><td>Iron</td><td>3.8 mg (27%*)</td></tr>
                            </tbody>
                        </table>
                        <p class="nutrition-note">*of daily reference intake</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Cooking -->
    <section class="cooking">
        <div class="cooking-inner">
            <h2 class="reveal">Cook it your way</h2>
            <div class="cooking-steps">
                <div class="step reveal" style="--delay: 0.1s">
                    <div class="step-num">1</div>
                    <h3>Season</h3>
                    <p>Your blank canvas. Go wild or keep it simple with salt & pepper.</p>
                </div>
                <div class="step reveal" style="--delay: 0.2s">
                    <div class="step-num">2</div>
                    <h3>Heat</h3>
                    <p>Oil in pan. Get it hot. Don't be shy — high heat is your friend.</p>
                </div>
                <div class="step reveal" style="--delay: 0.3s">
                    <div class="step-num">3</div>
                    <h3>Sear</h3>
                    <p>Golden edges. Crispy outside. 3-5 minutes. Done.</p>
                </div>
            </div>
            <div class="cooking-meta reveal">
                <div class="meta-item">
                    <strong>3-5 min</strong>
                    <span>Cook time</span>
                </div>
                <div class="meta-item">
                    <strong>High</strong>
                    <span>Heat</span>
                </div>
                <div class="meta-item">
                    <strong>3-4</strong>
                    <span>Servings</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Recipes -->
    <section class="recipes">
        <div class="recipes-header">
            <h2 class="reveal">Make something</h2>
            <a href={`${base}recipes`} class="reveal">All recipes →</a>
        </div>
        <div class="recipes-scroll">
            {featuredRecipes.map((recipe) => (
                <a href={`${base}recipes/${recipe.data.slug}`} class="recipe-card">
                    <div class="recipe-img">
                        <img src={recipe.data.image} alt={recipe.data.title} loading="lazy">
                    </div>
                    <div class="recipe-info">
                        <h3>{recipe.data.title}</h3>
                        <span>{recipe.data.cookTime} min · {recipe.data.difficulty}</span>
                    </div>
                </a>
            ))}
        </div>
    </section>

    <!-- CTA -->
    <section class="cta">
        <h2>Try it.</h2>
        <div class="cta-buttons">
            <a href={`${base}#locator`} class="btn btn-primary">Find planted near you</a>
            <a href={`${base}products`} class="btn btn-secondary">See all products</a>
        </div>
    </section>
</Layout>

<style define:vars={{ mainColor: colors.main, lightColor: colors.light, darkColor: colors.dark }}>
    :root {
        --purple: #61269E;
        --purple-dark: #4A1D7A;
        --green: #6BBF59;
        --cream: #FDF8F3;
        --black: #1A1A1A;
    }

    /* ==================== HERO ==================== */
    .hero {
        min-height: 250vh;
        position: relative;
    }

    .hero-sticky {
        position: sticky;
        top: 0;
        height: 100vh;
        height: 100dvh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    /* Animated gradient background */
    .hero-bg {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            135deg,
            color-mix(in srgb, var(--mainColor) 100%, white 20%) 0%,
            var(--mainColor) 30%,
            var(--darkColor) 70%,
            color-mix(in srgb, var(--darkColor) 100%, black 20%) 100%
        );
        background-size: 200% 200%;
        animation: gradientMove 12s ease infinite;
    }

    @keyframes gradientMove {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* Subtle grain texture */
    .hero-bg::after {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.03;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* Dish image layer */
    .hero-dish {
        position: absolute;
        inset: 0;
        opacity: 0;
        transform: scale(1.05);
        transition: opacity 0.8s ease, transform 1.5s cubic-bezier(0.16, 1, 0.3, 1);
        will-change: opacity, transform;
    }

    .hero-dish.visible {
        opacity: 1;
        transform: scale(1);
    }

    .hero-dish img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center 40%;
    }

    /* Gradient overlay on dish */
    .hero-dish::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(
            180deg,
            color-mix(in srgb, var(--mainColor) 40%, transparent) 0%,
            transparent 25%,
            transparent 55%,
            color-mix(in srgb, var(--mainColor) 95%, transparent) 100%
        );
    }

    /* Pack shot */
    .hero-pack {
        position: relative;
        z-index: 10;
        width: clamp(220px, 35vw, 380px);
        transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform, opacity, filter;
        filter: drop-shadow(0 30px 50px rgba(0,0,0,0.3));
    }

    .hero-pack img {
        width: 100%;
        height: auto;
        transform: rotate(-5deg);
        transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .hero-pack:hover img {
        transform: rotate(-2deg) scale(1.02);
    }

    .product-badge-new {
        position: absolute;
        top: -10px;
        right: -10px;
        background: var(--green);
        color: var(--black);
        font-size: 0.7rem;
        font-weight: 700;
        padding: 0.4rem 0.8rem;
        border-radius: 100px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        z-index: 5;
    }

    /* Product info at bottom */
    .hero-info {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 3rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        gap: 2rem;
        z-index: 20;
        opacity: 0;
        transform: translateY(40px);
        transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        transition-delay: 0.2s;
    }

    .hero-info.visible {
        opacity: 1;
        transform: translateY(0);
    }

    .hero-text h1 {
        font-size: clamp(2.5rem, 8vw, 5rem);
        color: white;
        margin-bottom: 0.3rem;
        letter-spacing: -0.02em;
    }

    .hero-text .variant {
        font-size: clamp(1rem, 2.5vw, 1.35rem);
        color: rgba(255,255,255,0.8);
        font-weight: 400;
        max-width: 400px;
    }

    /* The big protein number */
    .hero-protein {
        text-align: right;
        flex-shrink: 0;
    }

    .protein-number {
        font-family: 'VC Henrietta', Georgia, serif;
        font-size: clamp(6rem, 22vw, 16rem);
        line-height: 0.75;
        letter-spacing: -0.04em;
        display: flex;
        align-items: baseline;
    }

    .protein-number .value {
        color: white;
        text-shadow:
            0 4px 0 rgba(0,0,0,0.08),
            0 12px 30px rgba(0,0,0,0.15);
    }

    .protein-number .unit {
        color: var(--green);
        font-size: 0.6em;
        margin-left: -0.05em;
        text-shadow: 0 0 60px rgba(107, 191, 89, 0.5);
    }

    .protein-label {
        color: rgba(255,255,255,0.7);
        font-size: clamp(0.65rem, 1.5vw, 0.85rem);
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-weight: 600;
        margin-top: 0.5rem;
    }

    /* Scroll indicator */
    .scroll-hint {
        position: absolute;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        z-index: 30;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        color: rgba(255,255,255,0.5);
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        transition: opacity 0.4s ease;
    }

    .scroll-hint.hidden {
        opacity: 0;
        pointer-events: none;
    }

    .scroll-hint .arrow {
        width: 20px;
        height: 20px;
        border-right: 2px solid currentColor;
        border-bottom: 2px solid currentColor;
        transform: rotate(45deg);
        animation: scrollBounce 1.5s ease-in-out infinite;
    }

    @keyframes scrollBounce {
        0%, 100% { transform: rotate(45deg) translate(0, 0); opacity: 1; }
        50% { transform: rotate(45deg) translate(3px, 3px); opacity: 0.5; }
    }

    @media (max-width: 700px) {
        .hero-info {
            flex-direction: column;
            align-items: flex-start;
            padding: 2rem;
            gap: 1rem;
        }
        .hero-protein { text-align: left; }
    }

    /* ==================== STATS BAR ==================== */
    .stats {
        background: var(--purple);
        padding: 2rem 1.5rem;
        position: relative;
    }

    .stats-grid {
        display: flex;
        justify-content: center;
        gap: 3rem;
        flex-wrap: wrap;
        max-width: 700px;
        margin: 0 auto;
    }

    .stat {
        text-align: center;
        min-width: 80px;
    }

    .stat-value {
        font-family: 'VC Henrietta', Georgia, serif;
        font-size: clamp(1.75rem, 5vw, 2.5rem);
        color: var(--green);
        line-height: 1;
    }

    .stat-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(255,255,255,0.6);
        margin-top: 0.4rem;
    }

    .stat.highlight .stat-value {
        color: white;
    }

    /* ==================== TRUST BADGES ==================== */
    .trust {
        background: var(--cream);
        padding: 1.75rem 1.5rem;
        display: flex;
        justify-content: center;
        gap: 2.5rem;
        flex-wrap: wrap;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .trust-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--purple);
        font-size: 0.8rem;
        font-weight: 600;
        opacity: 0.7;
    }

    .trust-badge svg {
        width: 20px;
        height: 20px;
        opacity: 0.8;
    }

    /* ==================== INGREDIENTS ==================== */
    .ingredients {
        padding: 5rem 1.5rem;
        max-width: 800px;
        margin: 0 auto;
    }

    .ingredients h2 {
        font-size: clamp(2rem, 6vw, 3rem);
        color: var(--purple);
        margin-bottom: 2rem;
    }

    .pills {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }

    .pill {
        background: white;
        padding: 0.9rem 1.5rem;
        border-radius: 100px;
        font-weight: 600;
        color: var(--purple);
        border: 1px solid rgba(97,38,158,0.08);
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        transition: all 0.25s ease;
        transition-delay: var(--delay, 0s);
    }

    .pill:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(97,38,158,0.12);
        border-color: rgba(97,38,158,0.15);
    }

    .ingredient-note {
        display: inline-block;
        background: var(--green);
        color: var(--black);
        padding: 0.9rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 700;
        margin-top: 2rem;
        transform: rotate(-1.5deg);
        box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
        transition: transform 0.2s ease;
    }

    .ingredient-note:hover {
        transform: rotate(0.5deg) scale(1.02);
    }

    /* ==================== NUTRITION ==================== */
    .nutrition {
        background: white;
    }

    .nutrition-layout {
        display: grid;
        grid-template-columns: 1fr;
    }

    @media (min-width: 800px) {
        .nutrition-layout {
            grid-template-columns: 1fr 1fr;
        }
    }

    .nutrition-image {
        position: relative;
        min-height: 350px;
        overflow: hidden;
    }

    .nutrition-image img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 6s ease-out;
    }

    .nutrition-image:hover img {
        transform: scale(1.03);
    }

    /* Wavy divider */
    .nutrition-image::after {
        content: '';
        position: absolute;
        right: -1px;
        top: 0;
        bottom: 0;
        width: 80px;
        background: white;
        clip-path: ellipse(70% 50% at 100% 50%);
    }

    @media (max-width: 799px) {
        .nutrition-image::after { display: none; }
    }

    .nutrition-content {
        padding: 3rem 2.5rem;
    }

    .nutrition-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .nutrition-header h2 {
        font-size: clamp(1.4rem, 4vw, 1.8rem);
        color: var(--purple);
    }

    .nutrition-toggle {
        width: 40px;
        height: 40px;
        background: var(--cream);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .nutrition-toggle:hover {
        background: var(--purple);
    }

    .nutrition-toggle:hover svg {
        stroke: white;
    }

    .nutrition-toggle svg {
        width: 18px;
        height: 18px;
        stroke: var(--purple);
        transition: transform 0.3s ease, stroke 0.3s ease;
    }

    .nutrition-toggle.open svg {
        transform: rotate(180deg);
    }

    /* Collapsible table - THE FIX */
    .nutrition-table {
        display: grid;
        grid-template-rows: 0fr;
        transition: grid-template-rows 0.4s ease;
    }

    .nutrition-table.open {
        grid-template-rows: 1fr;
    }

    .nutrition-table-inner {
        overflow: hidden;
    }

    .nutrition-table table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
    }

    .nutrition-table th {
        text-align: left;
        padding: 0.5rem 0;
        font-size: 0.6rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--purple);
        opacity: 0.5;
        border-bottom: 2px solid var(--purple);
    }

    .nutrition-table th:last-child { text-align: right; }

    .nutrition-table td {
        padding: 0.6rem 0;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        transition: all 0.2s ease;
    }

    .nutrition-table td:last-child {
        text-align: right;
        font-weight: 600;
        color: var(--purple);
    }

    .nutrition-table tr:hover td {
        background: rgba(97,38,158,0.02);
    }

    .nutrition-table tr.sub td:first-child {
        padding-left: 1rem;
        font-size: 0.8rem;
        opacity: 0.6;
    }

    .nutrition-table tr.protein-row td {
        background: rgba(107,191,89,0.08);
        font-weight: 600;
    }

    .nutrition-table tr.protein-row td:last-child {
        color: var(--green);
    }

    .nutrition-note {
        font-size: 0.65rem;
        color: var(--black);
        opacity: 0.4;
        margin-top: 1rem;
    }

    /* ==================== COOKING ==================== */
    .cooking {
        background: var(--cream);
        padding: 5rem 1.5rem;
    }

    .cooking-inner {
        max-width: 850px;
        margin: 0 auto;
    }

    .cooking h2 {
        font-size: clamp(2rem, 6vw, 3rem);
        color: var(--purple);
        margin-bottom: 2.5rem;
        text-align: center;
    }

    .cooking-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1.5rem;
    }

    .step {
        background: white;
        padding: 2rem 1.5rem;
        border-radius: 1.25rem;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        transition-delay: var(--delay, 0s);
    }

    .step:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 40px rgba(0,0,0,0.08);
    }

    .step-num {
        width: 48px;
        height: 48px;
        background: var(--purple);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'VC Henrietta', Georgia, serif;
        font-size: 1.25rem;
        margin: 0 auto 1rem;
    }

    .step h3 {
        color: var(--purple);
        font-size: 1.15rem;
        margin-bottom: 0.4rem;
    }

    .step p {
        color: var(--black);
        opacity: 0.65;
        font-size: 0.9rem;
        line-height: 1.5;
    }

    .cooking-meta {
        display: flex;
        justify-content: center;
        gap: 3rem;
        margin-top: 2.5rem;
        flex-wrap: wrap;
    }

    .meta-item {
        text-align: center;
    }

    .meta-item strong {
        display: block;
        font-family: 'VC Henrietta', Georgia, serif;
        font-size: 1.5rem;
        color: var(--purple);
    }

    .meta-item span {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--black);
        opacity: 0.5;
    }

    /* ==================== RECIPES ==================== */
    .recipes {
        padding: 5rem 0;
        background: white;
    }

    .recipes-header {
        padding: 0 1.5rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1000px;
        margin: 0 auto;
    }

    .recipes-header h2 {
        font-size: clamp(2rem, 6vw, 3rem);
        color: var(--purple);
    }

    .recipes-header a {
        color: var(--purple);
        font-weight: 700;
        text-decoration: none;
        font-size: 0.9rem;
        transition: opacity 0.2s;
    }

    .recipes-header a:hover { opacity: 0.7; }

    .recipes-scroll {
        display: flex;
        gap: 1.5rem;
        overflow-x: auto;
        padding: 0 1.5rem 1rem;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;
        /* Fade edges */
        mask-image: linear-gradient(90deg, transparent, black 3%, black 97%, transparent);
        -webkit-mask-image: linear-gradient(90deg, transparent, black 3%, black 97%, transparent);
    }

    .recipes-scroll::-webkit-scrollbar { display: none; }

    .recipe-card {
        flex: 0 0 300px;
        scroll-snap-align: start;
        background: var(--cream);
        border-radius: 1.25rem;
        overflow: hidden;
        text-decoration: none;
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.4s ease;
    }

    .recipe-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.12);
    }

    .recipe-img {
        aspect-ratio: 4/3;
        overflow: hidden;
    }

    .recipe-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .recipe-card:hover .recipe-img img {
        transform: scale(1.08);
    }

    .recipe-info {
        padding: 1.25rem;
    }

    .recipe-info h3 {
        font-size: 1.1rem;
        color: var(--purple);
        margin-bottom: 0.2rem;
    }

    .recipe-info span {
        font-size: 0.8rem;
        color: var(--black);
        opacity: 0.5;
    }

    /* ==================== CTA ==================== */
    .cta {
        background: var(--green);
        padding: 6rem 1.5rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .cta::before {
        content: '';
        position: absolute;
        inset: -50%;
        background: radial-gradient(circle at 30% 50%, rgba(255,255,255,0.12) 0%, transparent 50%);
        animation: ctaGlow 10s ease-in-out infinite alternate;
    }

    @keyframes ctaGlow {
        0% { transform: translate(-10%, -10%) scale(1); }
        100% { transform: translate(10%, 10%) scale(1.2); }
    }

    .cta h2 {
        font-size: clamp(3.5rem, 14vw, 7rem);
        color: var(--black);
        margin-bottom: 2rem;
        position: relative;
    }

    .cta-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        position: relative;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 1.15rem 2rem;
        border-radius: 100px;
        font-weight: 700;
        font-size: 1rem;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--purple);
        color: white;
        box-shadow: 0 6px 20px rgba(97,38,158,0.35);
    }

    .btn-primary:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(97,38,158,0.4);
    }

    .btn-secondary {
        background: white;
        color: var(--purple);
    }

    .btn-secondary:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    }

    /* ==================== ANIMATIONS ==================== */
    .reveal {
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                    transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        transition-delay: var(--delay, 0s);
    }

    .reveal.visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<script>
    // ==================== HERO SCROLL ANIMATION ====================
    const hero = document.getElementById('hero');
    const heroPack = document.getElementById('heroPack');
    const heroDish = document.getElementById('heroDish');
    const heroInfo = document.getElementById('heroInfo');
    const scrollHint = document.getElementById('scrollHint');

    let ticking = false;

    function updateHero() {
        if (!hero || !heroPack) return;

        const rect = hero.getBoundingClientRect();
        const scrollDistance = hero.offsetHeight - window.innerHeight;
        const progress = Math.min(Math.max(-rect.top / scrollDistance, 0), 1);

        // Pack: scale down, rotate, move up, fade out, blur
        if (progress < 0.5) {
            const packProgress = progress * 2; // 0 to 1 over first half of scroll
            const scale = 1 - (packProgress * 0.5);
            const rotate = packProgress * 25;
            const translateY = packProgress * -35;
            const opacity = 1 - (packProgress * 1.5);
            const blur = packProgress * 6;

            heroPack.style.transform = `scale(${scale}) rotate(${rotate}deg) translateY(${translateY}vh)`;
            heroPack.style.opacity = String(Math.max(opacity, 0));
            heroPack.style.filter = `drop-shadow(0 30px 50px rgba(0,0,0,0.3)) blur(${blur}px)`;
        } else {
            heroPack.style.opacity = '0';
        }

        // Dish: fade in and slight scale
        if (heroDish) {
            if (progress > 0.25) {
                heroDish.classList.add('visible');
            } else {
                heroDish.classList.remove('visible');
            }
        }

        // Info: slide up
        if (heroInfo) {
            if (progress > 0.45) {
                heroInfo.classList.add('visible');
            } else {
                heroInfo.classList.remove('visible');
            }
        }

        // Scroll hint
        if (scrollHint) {
            if (progress > 0.05) {
                scrollHint.classList.add('hidden');
            } else {
                scrollHint.classList.remove('hidden');
            }
        }

        ticking = false;
    }

    window.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(updateHero);
            ticking = true;
        }
    });

    updateHero();

    // ==================== NUTRITION TOGGLE ====================
    const nutritionToggle = document.getElementById('nutritionToggle');
    const nutritionTable = document.getElementById('nutritionTable');

    if (nutritionToggle && nutritionTable) {
        // Start open
        nutritionTable.classList.add('open');
        nutritionToggle.classList.add('open');

        nutritionToggle.addEventListener('click', () => {
            nutritionTable.classList.toggle('open');
            nutritionToggle.classList.toggle('open');
        });
    }

    // ==================== SCROLL REVEAL ====================
    const revealElements = document.querySelectorAll('.reveal');

    const revealObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, {
        threshold: 0.15,
        rootMargin: '0px 0px -60px 0px'
    });

    revealElements.forEach(el => revealObserver.observe(el));
</script>
